<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Leaflet Karte</title>

    <!-- Fügt das Website-Icon (Favicon) hinzu -->
    <link rel="icon" type="image/png" href="img/weather2.png" />

    <!-- Fügt Leaflet CSS hinzu -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
    />

    <!-- Fügt Leaflet JavaScript hinzu -->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>

    <style>
      /* Stil für die Karte */
      #map {
        height: 80vh; /* This sets the height to 80% of the viewport height */
        min-height: 800px; /* This ensures that the element is at least 800px tall */
        max-height: 2000px; /* This sets a maximum height of 1000px, if needed */
        width: 98%;
        border: 18px solid #3e3f3c; /* Grauer Rahmen */
        margin: 0 auto; /* Zentriere das Element horizontal */
      }
      /* Stil der Website*/
      body {
        color: #ffffff; /* Weiß */
        background-color: #7ab41d; /* Farbwert in Hexadezimal */
        font-family: Graphik;
      }
    </style>
  </head>
  <body>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"></script>
    <header style="background-color: #3e3f3c">
      <h1>SII - Final Assignment</h1>
    </header>

    <nav>
      <ul>
        <li>
          <a>Maximilian Reiner, Lena Long, Andreas Suffert, Dominik Waldmann</a>
        </li>
      </ul>
    </nav>
    <main>
      <h2>
        Aktuelle Wetterdaten von Städten NRW`s mit über 100.000 Einwohnern
      </h2>
      <!-- Hier wird die Karte eingefügt -->
      <div id="map"></div>
    </main>

    <footer id="footer">
      <div class="footer-content">
        <p>
          &copy; SII - SPATIAL INFORMATION INFRASTRUCTURE WISE 2023/24, SIMON
          JIRKA, ALBERT REMKE
        </p>
      </div>
      <style>
        #footer {
          position: absolute;
          bottom: 0;
          width: 100%;
          height: 30px; /* oder die gewünschte Höhe des Footers */
          background-color: #3e3f3c; /* Farbwert in Hexadezimal */
          color: #ffffff; /* Textfarbe */
          border: 5px solid #7ab41d; /* Set a border with a width of 1px, a solid style, and a gray color */
        }
        .footer-content {
          display: flex;
          justify-content: center; /* Horizontal zentrieren */
          align-items: center; /* Vertikal zentrieren */
          height: 100%;
        }
        .footer-content p {
          margin: 0; /* Entfernt den Standardabstand des Absatzes */
        }
      </style>
    </footer>

    <!-- Add jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"></script>
    <script>
      // Add AJAX request for data
      var counties = $.ajax({
        url: "https://gist.githubusercontent.com/maptastik/df8e483d5ac1c6cae3dc4a7c02ea9039/raw/9cd46849bddcfa90aab240772a12275408d6d8d0/kyCounties.geojson",
        dataType: "json",
        success: console.log("County data successfully loaded."),
        error: function (xhr) {
          alert(xhr.statusText);
        },
      });

      /* Lade die GeoJSON-Datei und füge sie zur Karte hinzu
      $.getJSON("data.geojson", function (data) {
        L.geoJSON(data).addTo(mymap);
      }); */
      // JavaScript-Code für die Karte
      var mymap = L.map("map").setView([51.5, 7.5], 8); // Lade die Karte und setze die Koordinaten und Zoomstufe

      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        // Hinzufügen einer Kartenfliese (Tile Layer) von OpenStreetMap
        maxZoom: 19,
      }).addTo(mymap);

      // Koordinaten und Städtenamen für Städte in NRW mit über 100.000 Einwohnern
      var cities = [
        { name: "Köln", coordinates: [50.9375, 6.9603] },
        { name: "Düsseldorf", coordinates: [51.2277, 6.7735] },
        { name: "Dortmund", coordinates: [51.5136, 7.4653] },
        { name: "Essen", coordinates: [51.4556, 7.0116] },
        { name: "Duisburg", coordinates: [51.4344, 6.7623] },
        { name: "Bochum", coordinates: [51.4812, 7.2195] },
        { name: "Wuppertal", coordinates: [51.2647, 7.1784] },
        { name: "Bielefeld", coordinates: [52.0291, 8.5424] },
        { name: "Bonn", coordinates: [50.7374, 7.0982] },
        { name: "Gelsenkirchen", coordinates: [51.5177, 7.0857] },
        { name: "Mönchengladbach", coordinates: [51.1805, 6.4428] },
        { name: "Aachen", coordinates: [50.7753, 6.0839] },
        { name: "Krefeld", coordinates: [51.3397, 6.5853] },
        { name: "Oberhausen", coordinates: [51.4964, 6.8638] },
        { name: "Hagen", coordinates: [51.3671, 7.4636] },
        { name: "Hamm", coordinates: [51.6736, 7.8155] },
        { name: "Herne", coordinates: [51.5388, 7.2257] },
        { name: "Mülheim an der Ruhr", coordinates: [51.4309, 6.8783] },
        { name: "Solingen", coordinates: [51.1734, 7.0845] },
        { name: "Leverkusen", coordinates: [51.0451, 7.0193] },
        { name: "Neuss", coordinates: [51.2042, 6.6879] },
        { name: "Paderborn", coordinates: [51.7191, 8.7544] },
        { name: "Recklinghausen", coordinates: [51.6141, 7.1976] },
        { name: "Bottrop", coordinates: [51.5215, 6.9443] },
        { name: "Münster", coordinates: [51.9607, 7.6261] },
      ];

      // Marker für alle Städte hinzufügen
      cities.forEach(function (cities) {
        let marker = L.marker(cities.coordinates).addTo(mymap);
        marker.on("click", function () {
          getWeatherData(
            cities.name,
            cities.coordinates[0],
            cities.coordinates[1],
            marker
          );
        });
      });

      // Funktion, um Wetterdaten von OpenMeteo API abzurufen
      async function getWeatherData(name, latitude, longitude, marker) {
        let apiUrl =
          "https://api.open-meteo.com/v1/forecast?latitude=" +
          latitude +
          "&longitude=" +
          longitude +
          "&current_weather=true";
        console.log(apiUrl);
        fetch(apiUrl)
          .then((response) => response.json())
          .then((data) => {
            if (data && data.current_weather) {
              var currentWeather = data.current_weather;
              var popupContent = `Temperatur: ${currentWeather.temperature} °C <br>`;
              popupContent += `Windgeschwindigkeit: ${currentWeather.windspeed} km/h <br>`;
              popupContent += `Windrichtung: ${currentWeather.winddirection} °<br>`;
              // popupContent += `Niederschlagswahrscheinlichkeit: ${currentWeather.precipitation_probability} %<br>`;
              // popupContent += `Wetterwarnungen: ${currentweatherData.alerts} !<br>`;

              // Popup-Inhalt aktualisieren
              marker.bindPopup(name + "<br>" + popupContent).openPopup();
            } else {
              console.error("Ungültige Wetterdaten:", data);
            }
          })
          .catch((error) => {
            console.error("Fehler beim Abrufen der Wetterdaten:", error);
          });
      }

      // Eigens erstelltest Polygon NRW´s
      /*
      L.polygon([
        [52.0524625040471, 7.9664058121918515],
        [52.093851851138055, 7.904679722290439],
        [52.114532137805156, 7.988851663063457],
        [52.17307421605017, 7.994463125782403],
        [52.18339718328474, 7.921514110445855],
        [52.29335980867555, 7.910291185009356],
        [52.35166667555549, 7.949571424036407],
        [52.3756530567054, 7.820507781517421],
        [52.44069332085101, 7.691444138998321],
        [52.4577932431271, 7.579214884634865],
        [52.409896728974275, 7.596049272788889],
        [52.34823898658129, 7.495042943861762],
        [52.27276256727609, 7.281807360569815],
        [52.25215575053667, 7.04051446368581],
        [52.17995646041311, 6.922673746603294],
        [52.12142343573714, 6.787998641366698],
        [52.0524625040471, 6.686992312439685],
        [51.98339497059075, 6.827278880393777],
        [51.883057564529565, 6.715049626030236],
        [51.90729748205899, 6.614043297101745],
        [51.872665025166015, 6.473756729147624],
        [51.865735331006135, 6.383973325655688],
        [51.82413474126923, 6.383973325655688],
        [51.86920031155003, 6.215629444109652],
        [51.91768201537812, 6.170737742363684],
        [51.90383543728231, 6.097788727027137],
        [51.84840642409887, 6.17634920508263],
        [51.84493984182467, 6.092177264308162],
        [51.84147299256787, 5.974336547225704],
        [51.75471496884035, 5.963113621790512],
        [51.71301180965048, 6.024839711690589],
        [51.66778995389984, 6.052897025281169],
        [51.66082873505201, 6.109011652463607],
        [51.59812962694113, 6.103400189744633],
        [51.56325933734237, 6.1426804287731045],
        [51.4759665177813, 6.215629444109652],
        [51.392007947317694, 6.198795055954179],
        [51.36398746114466, 6.215629444109652],
        [51.328937729678984, 6.17634920508263],
        [51.286842660673585, 6.125846040617631],
        [51.230655823291016, 6.080954338871635],
        [51.199020543671566, 6.080954338871635],
        [51.1919875295296, 6.13706896605413],
        [51.199020543671566, 6.181960667800155],
        [51.19454972639073, 6.15222649677176],
        [51.15810856251562, 6.158039173568312],
        [51.11799001065333, 6.041785637652026],
        [51.06322670298408, 5.92553210173719],
        [51.02302572294778, 5.861592656983959],
        [50.99010806039627, 5.931344778532264],
        [50.97547048938756, 5.995284223286973],
        [50.93153008237476, 6.04759831444855],
        [50.85820372760122, 6.082474375223455],
        [50.821497248198256, 6.018534930470224],
        [50.75167537154297, 6.035972960856924],
        [50.7112045102719, 6.163851850363386],
        [50.63384484148102, 6.198727911138292],
        [50.608029950369115, 6.268480032688046],
        [50.567435059390334, 6.216165941526469],
        [50.530500236954225, 6.198727911138292],
        [50.504628644063786, 6.221978618321515],
        [50.50093154458955, 6.303356093462952],
        [50.460244346397616, 6.355670184624529],
        [50.375057904319135, 6.367295538216155],
        [50.37135067050295, 6.431234982969414],
        [50.363935333818745, 6.541675842089148],
        [50.36022723093657, 6.628865994025631],
        [50.352810156056364, 6.727681499553768],
        [50.36022723093657, 6.809058974695176],
        [50.445440316817525, 6.7567448835335995],
        [50.47504374382373, 6.785808267511925],
        [50.460244346397616, 6.849747712265128],
        [50.52310980023944, 6.907874480223285],
        [50.56374287911132, 6.977626601773039],
        [50.58958206605101, 7.06481675370955],
        [50.61909521028943, 7.1926956432160125],
        [50.63384484148102, 7.314761855927372],
        [50.703842415032454, 7.37288862388553],
        [50.71488512437412, 7.460078775822012],
        [50.759029953618466, 7.593770342125026],
        [50.78843672607246, 7.663522463674809],
        [50.847194836994646, 7.721649220206928],
        [50.91320933820592, 7.768150634573459],
        [50.9315301037914, 7.762337957776907],
        [50.92420266326613, 7.8320900793267185],
        [50.83251224534709, 7.948343615242976],
        [50.711204531789804, 8.093660535136138],
        [50.7884367475549, 8.16341265668595],
        [50.87654616179992, 8.302916899785487],
        [50.87654616179992, 8.3784816981304],
        [50.938856390110345, 8.448233819678677],
        [51.00108323152622, 8.512173264433358],
        [51.077836613879896, 8.506360587636806],
        [51.09974280120059, 8.6633028611231],
        [51.18726381903471, 8.74468033626448],
        [51.270982462982346, 8.703991598693051],
        [51.252795712770535, 8.587738062778243],
        [51.28916201786623, 8.558674678798411],
        [51.33639519373605, 8.616801446756568],
        [51.37269532339579, 8.738867659467928],
        [51.40896669466002, 8.924873316932548],
        [51.49228175545349, 8.884184579362568],
        [51.52122527542855, 9.041126852848862],
        [51.45969831605899, 9.116691651193719],
        [51.48504300252776, 9.22131983351693],
        [51.56099259939714, 9.32013533904501],
        [51.652535505658165, 9.413442035950709],
        [51.753401051006506, 9.395997836662787],
        [51.86122173958006, 9.44249925102929],
        [51.87557834880124, 9.33787106870463],
        [51.95803994259501, 9.262306270359772],
        [51.98310689398224, 9.163490764831607],
        [52.07966239882572, 9.186741472014887],
        [52.14391693855194, 9.11117667367003],
        [52.14034967108228, 9.006548491345342],
        [52.183138024611736, 9.006548491345342],
        [52.225885247581516, 9.053049905711873],
        [52.27570504429292, 8.977485107367016],
        [52.343228160283275, 9.02398652173207],
        [52.417739184766816, 9.122802027261656],
        [52.48504561118543, 9.116989350465133],
        [52.49566354023003, 9.04723722891535],
        [52.40710245025841, 8.896107632225608],
        [52.392916146861296, 8.698476621169391],
        [52.52750194843392, 8.65197520680286],
        [52.499202280271334, 8.547347024479677],
        [52.49212451537491, 8.448531518951569],
        [52.460260473502245, 8.425280811768317],
        [52.449633998208014, 8.291589245465303],
        [52.4000098686937, 8.338090659831778],
        [52.343228160283275, 8.454344195746614],
        [52.26147652558393, 8.465969549338269],
        [52.215202296968016, 8.448531518951569],
        [52.179573899660056, 8.5124709637048],
        [52.13321427892029, 8.407842781380083],
        [52.12964615420981, 8.268338538282023],
        [52.06537103485255, 8.111396264795758],
        [52.04392541089632, 7.966079344901118],
        [52.0524625040471, 7.9664058121918515],
      ])
        .bindPopup("NRW")
        .addTo(mymap);
        */

      // Hinzufügen des WMS-Layers
      var wmsLayer = L.tileLayer
        .wms("https://www.wms.nrw.de/geobasis/wms_nw_dvg", {
          layers: "nw_dvg_bld",
          format: "image/png",
          transparent: true,
        })
        .addTo(mymap);
    </script>
  </body>
</html>
